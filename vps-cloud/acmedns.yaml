http:
  # Add the router
  routers:
    acmedns:
      entryPoints:
        - websecure
      service: acmedns
      rule: "Host(`acme.z-network.ru`)"
      middlewares:
        - gzip@file
      tls:
        certResolver: acme-dns
        domains:
          - main: "z-network.ru"
            sans:
              - "*.z-network.ru"

    acmedns-http:
      entryPoints:
        - web
      priority: 2000
      service: acmedns-http
      rule: "Host(`acme.z-network.ru`)"
      middlewares:
        - gzip@file

  # Add the service
  services:
    acmedns:
      loadBalancer:
        servers:
          - url: https://10.3.1.7
        passHostHeader: true
    acmedns-http:
      loadBalancer:
        servers:
          - url: http://10.3.1.7
        passHostHeader: true
tcp:
  # Add the router
  routers:
    acmedns-tcp:
      entryPoints:
        - acmedns-tcp
      service: acmedns-tcp
      rule: "HostSNI(`*`)"
      # will route TLS requests (and ignore non tls requests)
      #tls:
      #  passthrough: true

  # Add the service
  services:
    acmedns-tcp:
      loadBalancer:
        servers:
          - address: "10.3.1.7:53"

udp:
  # Add the router
  routers:
    acmedns-udp:
      entryPoints:
        - acmedns-udp
      service: acmedns-udp
      #rule: "HostSNI(`*`)"
      # will route TLS requests (and ignore non tls requests)
      #tls:
      #  passthrough: true

  # Add the service
  services:
    acmedns-udp:
      loadBalancer:
        servers:
          - address: "10.3.1.7:53"